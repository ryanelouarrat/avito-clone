<% content_for :head do %>
  <%= stylesheet_link_tag "annonces/index", media: "all" %>
<% end %>

<%# Add spacing to avoid header overlap %>

<!-- Search area -->
<div class="search-area">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <form class="d-flex">
          <div class="input-group flex-grow-1">
            <input type="text" class="form-control search-input" placeholder="Que recherchez-vous ?">
            
            <div class="input-group-append">
              <button class="btn btn-outline-secondary dropdown-toggle category-select" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-grid me-2"></i> Toutes les catégories
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="#">Immobilier</a>
                <a class="dropdown-item" href="#">Véhicules</a>
                <a class="dropdown-item" href="#">Marketplace</a>
                <a class="dropdown-item" href="#">Emplois et Services</a>
              </div>
            </div>
            
            <div class="input-group-append">
              <button class="btn btn-outline-secondary dropdown-toggle location-select" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-geo-alt me-2"></i> Choisir ville - secteur
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="#">Casablanca</a>
                <a class="dropdown-item" href="#">Rabat</a>
                <a class="dropdown-item" href="#">Marrakech</a>
                <a class="dropdown-item" href="#">Tanger</a>
              </div>
            </div>
            
            <div class="input-group-append">
              <button class="btn btn-primary search-btn" type="submit">
                <i class="bi bi-search"></i> Rechercher
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Main categories with icons - Based on Avito UI -->
<div class="category-section">
  <div class="container">
    <div class="row">
      <div class="col-md-3 col-6">
        <a href="#" class="text-decoration-none text-dark">
          <div class="category-item">
            <div class="category-icon immobilier-icon">
              <i class="bi bi-house"></i>
            </div>
            <h6>Immobilier</h6>
          </div>
        </a>
      </div>
      <div class="col-md-3 col-6">
        <a href="#" class="text-decoration-none text-dark">
          <div class="category-item">
            <div class="category-icon vehicules-icon">
              <i class="bi bi-truck"></i>
            </div>
            <h6>Véhicules</h6>
          </div>
        </a>
      </div>
      <div class="col-md-3 col-6">
        <a href="#" class="text-decoration-none text-dark">
          <div class="category-item">
            <div class="category-icon marketplace-icon">
              <i class="bi bi-cart"></i>
            </div>
            <h6>Marketplace</h6>
          </div>
        </a>
      </div>
      <div class="col-md-3 col-6">
        <a href="#" class="text-decoration-none text-dark">
          <div class="category-item">
            <div class="category-icon emplois-icon">
              <i class="bi bi-briefcase"></i>
            </div>
            <h6>Emplois et Services</h6>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Catégories populaires -->
<div class="container mt-4 mb-5">
  <h4 class="mb-4">Catégories populaires</h4>
  
  <div class="row">
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #ff5c62; background-color: #ffebec;">
          <i class="bi bi-car-front"></i>
        </div>
        <h6 class="small text-center mt-2">VOITURES D'OCCASION</h6>
      </div>
    </div>
    
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #ff5c62; background-color: #ffebec;">
          <i class="bi bi-bicycle"></i>
        </div>
        <h6 class="small text-center mt-2">MOTOS</h6>
      </div>
    </div>
    
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #3f8ffc; background-color: #ebf3ff;">
          <i class="bi bi-house"></i>
        </div>
        <h6 class="small text-center mt-2">VENTES IMMOBILIÈRES</h6>
      </div>
    </div>
    
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #3f8ffc; background-color: #ebf3ff;">
          <i class="bi bi-key"></i>
        </div>
        <h6 class="small text-center mt-2">LOCATION IMMOBILIÈRE</h6>
      </div>
    </div>
    
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #3f8ffc; background-color: #ebf3ff;">
          <i class="bi bi-building"></i>
        </div>
        <h6 class="small text-center mt-2">APPARTEMENT LOCATION DE</h6>
      </div>
    </div>
    
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #28a745; background-color: #e8f8ed;">
          <i class="bi bi-lamp"></i>
        </div>
        <h6 class="small text-center mt-2">MAISON ET JARDIN</h6>
      </div>
    </div>
    
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #17a2b8; background-color: #e3f4f6;">
          <i class="bi bi-laptop"></i>
        </div>
        <h6 class="small text-center mt-2">INFORMATIQUE, MULTIMEDIA ET</h6>
      </div>
    </div>
    
    <div class="col-6 col-md-3 col-lg-2 mb-4">
      <div class="category-item">
        <div class="category-icon" style="color: #17a2b8; background-color: #e3f4f6;">
          <i class="bi bi-tshirt"></i>
        </div>
        <h6 class="small text-center mt-2">HABILLEMENT ET MODE</h6>
      </div>
    </div>
  </div>
</div>

<!-- Dernières annonces section (replacing Notre sélection premium) -->
<div class="container mb-5">
  <div class="section-header">
    <h3 class="section-title">Dernières annonces</h3>
    <div class="arrow-nav">
      <div class="arrow-btn"><i class="bi bi-chevron-left"></i></div>
      <div class="arrow-btn"><i class="bi bi-chevron-right"></i></div>
    </div>
  </div>
  
  <div class="row">
    <% @annonces.order(created_at: :desc).limit(4).each do |annonce| %>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="card h-100 shadow-sm">
          <% if [true, false].sample %>
            <div class="premium-badge">Premium</div>
          <% end %>
          
          <!-- Image -->
          <div class="card-img-container">
            <% if annonce.images.attached? && annonce.images.first.present? %>
              <%= image_tag annonce.images.first, class: "w-100 h-100 object-fit-cover" %>
            <% else %>
              <div class="w-100 h-100 bg-light d-flex align-items-center justify-content-center">
                <span>Pas d'image</span>
              </div>
            <% end %>
          </div>
          
          <div class="card-body p-3">
            <!-- User Info -->
            <div class="d-flex align-items-center mb-2">
              <div class="user-avatar bg-secondary">
                <i class="bi bi-person-circle text-white"></i>
              </div>
              <div class="time-badge">
                <i class="bi bi-clock me-1"></i> il y a <%= rand(1..24) %> heures
              </div>
            </div>
            
            <!-- Title -->
            <h5 class="card-title h6 fw-bold mb-2"><%= annonce.titre %></h5>
            
            <!-- Price -->
            <p class="price-text mt-auto mb-2"><%= annonce.prix %> MAD</p>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- All announcements -->
<div class="container mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0 fw-bold">Toutes les Annonces</h3>
  </div>
  
  <div class="row">
    <% @annonces.each do |annonce| %>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <!-- Image -->
          <div class="card-img-container">
            <% if annonce.images.attached? && annonce.images.first.present? %>
              <%= image_tag annonce.images.first, class: "w-100 h-100 object-fit-cover" %>
            <% else %>
              <div class="w-100 h-100 bg-light d-flex align-items-center justify-content-center">
                <span>Pas d'image</span>
              </div>
            <% end %>
          </div>
          
          <div class="card-body">
            <!-- Location -->
            <p class="text-muted small mb-2">
              <i class="bi bi-geo-alt"></i> <%= annonce.localisation %>
            </p>
            
            <!-- Title -->
            <h5 class="card-title fw-bold"><%= annonce.titre %></h5>
            
            <!-- Description - shortened -->
            <p class="card-text text-muted small"><%= annonce.description.truncate(80) %></p>
            
            <!-- Price -->
            <p class="price-text mt-auto mb-2"><%= annonce.prix %> MAD</p>
            
            <!-- Buttons -->
            <div class="btn-group btn-group-sm w-100">
              <%= link_to 'Voir', annonce_path(annonce), class: "btn btn-outline-primary" %>
              <%= link_to 'Modifier', edit_annonce_path(annonce), class: "btn btn-outline-warning" %>
              <%= button_to 'Supprimer', annonce_path(annonce),
                    method: :delete,
                    data: { turbo_confirm: 'Supprimer cette annonce ?' },
                    class: "btn btn-outline-danger",
                    form: { class: "d-inline" } %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

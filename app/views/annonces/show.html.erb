<!-- Breadcrumb navigation styled like in the image -->
<div class="breadcrumb-container py-2 border-bottom bg-light">
  <div class="container">
    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
      <ol class="breadcrumb mb-0 small">
        <li class="breadcrumb-item"><a href="<%= root_path %>" class="text-decoration-none text-secondary">Accueil</a></li>
        <li class="breadcrumb-item"><a href="<%= annonces_path %>" class="text-decoration-none text-secondary">Tout le Maroc</a></li>
        <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-secondary"><%= @annonce.localisation %></a></li>
        <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-secondary">Voitures</a></li>
        <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-secondary">Voitures d'occasion</a></li>
        <li class="breadcrumb-item active text-truncate" aria-current="page"><%= @annonce.titre %></li>
      </ol>
    </nav>
  </div>
</div>

<!-- Add JavaScript to control header animation -->
<% content_for :head do %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    let lastScrollTop = 0;
    const header = document.querySelector('.avito-header');
    
    window.addEventListener('scroll', function() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      
      // Show header effect when scrolling down more than 200px
      if (scrollTop > 200) {
        header.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
      } else {
        header.style.boxShadow = 'none';
      }
      
      lastScrollTop = scrollTop;
    });

    // Handle gallery image selection
    document.querySelectorAll('.gallery-thumbnail').forEach(thumb => {
      thumb.addEventListener('click', function() {
        const mainImg = document.getElementById('mainImage');
        mainImg.src = this.getAttribute('data-full-img');
        
        // Remove active class from all thumbnails
        document.querySelectorAll('.gallery-thumbnail').forEach(t => {
          t.classList.remove('active');
        });
        
        // Add active class to clicked thumbnail
        this.classList.add('active');
      });
    });
  });
</script>
<% end %>

<!-- Main Content -->
<div class="container mt-3">
  <!-- Image Gallery -->
  <div class="row">
    <div class="col-lg-8">
      <div class="position-relative">
        <!-- Modern Image Gallery -->
        <div class="image-gallery shadow-sm rounded">
          <!-- Main large image display -->
          <div class="main-image-container position-relative bg-light" style="height: 400px; overflow: hidden;">
            <% if @annonce.images.attached? && @annonce.images.first.present? %>
              <%= image_tag @annonce.images.first, id: "mainImage", class: "w-100 h-100", style: "object-fit: contain;" %>
              
              <!-- Image counter badge -->
              <div class="position-absolute" style="top: 10px; left: 10px; z-index: 10;">
                <span class="badge rounded-pill bg-white text-dark shadow-sm px-3 py-2">
                  <i class="bi bi-image"></i> <%= @annonce.images.count %> Images
                </span>
              </div>
              
              <!-- Share button -->
              <div class="position-absolute" style="top: 10px; right: 10px; z-index: 10;">
                <a href="#" class="btn btn-sm btn-light rounded-pill shadow-sm">
                  <i class="bi bi-share"></i> Partager
                </a>
              </div>
            <% else %>
              <div class="d-flex h-100 align-items-center justify-content-center">
                <i class="bi bi-image text-secondary" style="font-size: 5rem;"></i>
              </div>
            <% end %>
          </div>
          
          <!-- Thumbnails row -->
          <% if @annonce.images.attached? && @annonce.images.count > 1 %>
            <div class="gallery-thumbnails d-flex overflow-auto p-2 bg-white" style="gap: 8px;">
              <% @annonce.images.each_with_index do |image, index| %>
                <div class="gallery-thumbnail-container" style="flex: 0 0 80px;">
                  <%= image_tag image, 
                      class: "gallery-thumbnail rounded #{index == 0 ? 'active' : ''}",
                      style: "width: 80px; height: 80px; object-fit: cover; cursor: pointer; border: 2px solid #{index == 0 ? '#0d6efd' : 'transparent'};",
                      data: { full_img: url_for(image) } 
                  %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    
    <!-- Details Column -->
    <div class="col-lg-4">
      <!-- Title -->
      <h1 class="h3 mb-3"><%= @annonce.titre %></h1>
      
      <!-- Price -->
      <div class="mb-3">
        <span class="text-primary fw-bold" style="font-size: 2rem; color: #0d6efd !important;"><%= number_with_delimiter(@annonce.prix) %> DH</span>
      </div>
      
      <!-- Location and time -->
      <div class="mb-3 d-flex align-items-center">
        <i class="bi bi-geo-alt text-secondary me-1"></i>
        <span class="me-2"><%= @annonce.localisation %></span>
        <span class="text-secondary small">Il y a <%= time_ago_in_words(@annonce.date_publication) %></span>
      </div>
      
      <!-- Category Info -->
      <div class="mb-4">
        <div class="p-3 bg-light rounded d-flex align-items-center">
          <div class="me-3 text-danger">
            <i class="bi bi-car-front" style="font-size: 1.5rem;"></i>
          </div>
          <div>
            <div class="small text-secondary">Catégorie</div>
            <div><%= @annonce.category %>, à <%= @annonce.transaction_type == 'sell' ? 'vendre' : 'acheter' %></div>
          </div>
        </div>
      </div>
      
      <!-- Seller -->
      <div class="mb-4">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
              <i class="bi bi-person-circle" style="font-size: 1.8rem;"></i>
            </div>
          </div>
          <div>
            <div><%= @annonce.utilisateur.nom %></div>
            <div><a href="<%= utilisateur_path(@annonce.utilisateur) %>" class="small text-decoration-none">Voir la boutique</a></div>
          </div>
        </div>
      </div>
      
      <!-- Warning message -->
      <div class="alert border-start border-warning border-4 d-flex p-2 bg-light mb-4" style="border-left-width: 4px !important;">
        <div class="me-2 text-warning">
          <i class="bi bi-shield-exclamation"></i>
        </div>
        <div class="small">
          Il ne faut jamais envoyer d'argent à l'avance au vendeur par virement ou agence de transfert.
        </div>
      </div>
      
      <!-- Contact buttons -->
      <div class="d-flex gap-2 mb-2">
        <a href="#" class="btn btn-outline-success d-flex align-items-center justify-content-center" style="width: 50px;">
          <i class="bi bi-whatsapp fs-5"></i>
        </a>
        <button class="btn btn-primary flex-grow-1 d-flex align-items-center justify-content-center">
          <i class="bi bi-telephone me-2"></i> Contacter le Vendeur
        </button>
      </div>
      
      <!-- Report abuse -->
      <div class="text-center mb-4">
        <a href="#" class="text-danger small text-decoration-none">
          <i class="bi bi-exclamation-circle me-1"></i> SIGNALER UN ABUS
        </a>
      </div>
    </div>
  </div>
  
  <!-- Description section -->
  <div class="row mt-4">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="card-title border-bottom pb-2">Description</h5>
          <div class="card-text">
            <%= simple_format(@annonce.description) %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .gallery-thumbnail.active {
    border-color: #0d6efd !important;
    box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.25);
  }
  
  .gallery-thumbnails::-webkit-scrollbar {
    height: 6px;
  }
  
  .gallery-thumbnails::-webkit-scrollbar-thumb {
    background-color: rgba(0,0,0,0.2);
    border-radius: 10px;
  }
  
  .gallery-thumbnails::-webkit-scrollbar-track {
    background-color: rgba(0,0,0,0.05);
  }
</style>
